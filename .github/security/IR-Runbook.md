# CI/CD IR Runbook (минимум)

## 1. Когда это инцидент
- Любой алёрт из CloudWatch «NoAuditLogs_5min», «Secrets_Spike_5m_gt2», «RBAC_Spike_5m_gt1», «Prod_Deploy_Any».
- Любое странное изменение KMS/S3-политики (EventBridge алёрт).
- Любой незапланированный прод-деплой.

## 2. Кого звать (on-call)
- Ответственный: @team-sec (имена/телеграм/телефон)
- Эскалация: JonKing1995@proton.me

## 3. Где смотреть
- CloudWatch → Dashboards → **CI-Audit-Overview**
- CloudWatch → Logs → Log groups → `/aws/lambda/ci-audit-filter`
- Logs Insights (запросы сохранены): `audit_emit`, `SECRETS/ENVS`, `GOVERNANCE/RBAC/POLICIES`
- EventBridge → Rules: S3/KMS change alerts
- SNS topic: `ci-audit-alerts` (уведомления)

## 4. Что делаем сразу (5 минут)
1) Открыть дашборд и активные алармы.
2) В Logs Insights найти события по времени алёрта.
3) Если поход на прод — **заморозить деплой** (Protected env prod: pause/disable).
4) Если секреты/токены — **отозвать** затронутые ключи/токены (AWS/GitHub).
5) Зафиксировать факты: что, когда, кто (скриншоты, ссылки).

## 5. Как исправляем и откатываем
- Подмена артефакта/образа → откат на последний доверенный (подписанный) релиз.
- Неправильные права → вернуть прошлую версию политики/branch protection.
- Секреты → перевыпустить, перекатить деплой с новыми.

## 6. Коммуникации
- Сообщение в общий канал: кратко что случилось / статус / ETA.
- Тикет в Jira «INC-…» (создаётся автоматически из алёрта или руками).

## 7. После (post-incident)
- Ретроспектива (кратко): причина, что улучшили (политики, правила, проверки).
- Обновить runbook, если нашлись пробелы.

## 8. Учебная тревога (раз в квартал)
- Раз в 13 недель EventBridge шлёт напоминание «IR drill».
- Действия: открыть дашборд, прогнать пункты 4–7 в «сухом режиме».
- Результат: пометить в этом файле дату: **проверка пройдена** (кто/когда).
